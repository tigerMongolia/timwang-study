##### 1.set类型

###### 1.1 set类型来源

- 新的存储需求：存储大量的数据，在查询方面提供更高的效率
- 需要的存储结构：能够保存大量的数据，高效的内部存储机制，便于查询
- set类型：与hash存储结构完全相同，仅存储健，不存储值（nil），并且值是不允许重复的

![7886d5cfc9ec2e79ca3f6898d0073874.png](https://tva1.sinaimg.cn/large/007S8ZIlgy1gh5pjug1w6j30g80daaa6.jpg)

![86212cd0ae010c7e3e21044e5a5a8cfa.png](https://tva1.sinaimg.cn/large/007S8ZIlgy1gh5pk193g7j30l60ce0ss.jpg)

###### 1.2 set类型数据的基本操作

- 添加数据
```
sadd <key> <member1> [member2]...
```
- 获取全部数据
```
smembers <key>
```
- 删除数据
```
srem <key> <member1> [member2]...
```
- 获取集合数据总量
```
scard <key>
```
- 判断集合中是否包含指定数据
```
sismember <key> <member>
```

###### 1.3 set类型数据的扩展操作

1. 业务场景

每位用户首次使用今日头条时会设置3项爱好的内容，但是后期为了增加用户的活跃度、兴趣点，必须让用户对其他信息类别逐渐产生兴趣，增加客户留存度，如何实现

2. 业务分析

- 系统分析出各个分类的最新或最热点信息条目并组织成set集合
- 随机挑选其中部分信息
- 配合用户关注信息分类中的热点信息组织称展示的全信息集合

3. 解决方案

- 随机获取集合中指定数量的数据
```
sranmember <key> [count]
```
- 随机获取集合中的某个数据并将该数据并移出集合
```
spop <key>
```

###### 1.3 set类型数据的扩展操作2

1. 业务场景

脉脉为了促进用户间的交流，保障业务成单率的提升，需要让每位用户拥有大量的好友，事实上职场新人不具有更多的职场好友，如何快速为用户积累更多的好友？

新浪微博为了增加用户热度，提高用户留存性，需要微博用户在关注更多的人，以此获得更多的信息或热门话题，如何提高用户关注他人的总量

QQ新用户入网年龄越来越低，这些用户的朋友圈交际圈非常小，往往集中在一所学校甚至一个班级中，如何帮助用户快速积累好友用户带来更多的活跃度？

微信公众号是微信信息流通的渠道之一，增加用户关注的公众号成为提高用户活跃度的一种方式，如何帮助用户积累更多关注的公众号

美团外卖为了提高成单量，必须帮助用户挖掘美食需求，如何推荐给用户最适合自己的美食

2. 解决方案

- 求两个集合的交、并、差集
```
sinter <key1> [key2]...
sunion <key1> [key2]...
sdiff <key1> [key2]...
```
- 求两个集合的交、并、差集并存储到指定集合中
```
sinterstore <destination> <key1> [key2]..
sunionstore <destination> <key1> [key2]..
sdiffstore <destination> <key1> [key2]..
```
- 将指定数据从原始集合中移动到目标集合中
smove <source> <destination> <member>

###### 1.4 set类型数据的扩展操作3

- redis应用于同类信息的关联搜索，二度关联搜索，深度关联搜索
- 显示共同关注（一度）
- 显示共同好友（一度）
- 由用户A触发，获取到好友用户B的好友信息列表（一度）
- 由用户A触发，获取到好友用户B的购物清单列表（二度）
- 由用户A触发，获取到好友用户B的游戏充值列表（一度）

###### 1.5 set类型数据操作的注意事项

- set类型不允许数据重复，如果添加的数据在set中已经存在，将只保留一份

- set虽然与hash的存储结构相同，但是无法启用hash中存储值的空间

###### 1.6 set类型应用场景

1. 业务场景

集团公司具有12000名员工，内部OA系统中具有700多个角色，3000多个业务操作，23000多种数据，每位员工具有一个或多个角色，如何快速进行业务操作的权限校验

2. 解决方案

- 依赖set集合数据不重复的特征，依赖set集合hash存储结构特征完成数据过滤与快速查询
- 根据用户id获取用户所有角色
- 根据用户所有角色获取用户所有操作权限放入set集合
- 根据用户所有角色获取用户所有数据全选放入set集合

![ffceb0b1642bf3980d9f4e2fc44a1e33.png](https://tva1.sinaimg.cn/large/007S8ZIlgy1gh5pka0c1dj30ds09gweh.jpg)

###### 1.7 set类型应用场景2

1. 业务场景

公司对旗下新的网站做推广，统计网站的PV（访问量），UV（独立访客），IP（独立IP)

PV：网站被访问次数，可通过刷新页面提高访问量
UV：网站被不同用户访问的次数，可通过cookie统计访问量，相同用户切换IP地址，UV不变
IP：网站被不同IP地址访问的总次数，可通过IP地址统计访问量，相同IP不同用户访问，IP不变

2. 解决方案

- 利用set集合的数据去重特征，记录各种访问数据
- 建立string类型数据，利用incr统计日访问量（PV）
- 建立set模型，记录不同cookie数量（UV）
- 建立set模型，记录不同IP数量（IP）

###### 1.8 set类型应用场景3

1. 业务场景

黑名单
	资讯类信息类网站追求高访问量，但是由于其信息的价值，往往容易被不法分子利用，通过爬虫技术，快速获取信息，个别特种行业网站信息通过爬虫获取分析后，可以转化为商业机密进行出售，例如第三方火车票，机票，酒店刷票代购软件，电商刷评论，刷好评

	同时爬虫带来的伪流量也给经营者带来错觉，产生错误的决策，有效避免网站被爬虫反复爬取成为每个网站都要考虑的基本问题。在基于技术层面区分爬虫用户后，需要将此类用户进行有效的屏蔽，这就是黑名单的典型应用。

	ps：不是说爬虫一定在做摧毁性的工作，有些小型网站需要爬虫为其带来一些流量

白名单

	对于安全性更高的应用访问，仅仅靠黑名单是不能解决安全问题的，此时需要设定可访问的用户群体，依赖白名单做更为苛刻的访问验证
    
2. 解决方案

- 基于经营战略设定问题用户发现，鉴别规则
- 周期性更新满足规则的用户黑名单，加入set集合
- 用户行为信息达到后与黑名单进行比对，确认行为去向
- 黑名单过滤IP地址：应用于开放游客访问权限的信息源
- 黑名单过滤设备信息：应用于限定访问设备的信息源
- 黑名单过滤用户：应用于基于访问权限的信息源